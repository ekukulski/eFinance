<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:KukiFinance.Converters"
             x:Class="KukiFinance.Pages.CashFlowPage"
             Title="Cash Flow Projection">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:AmountColorConverter x:Key="AmountColorConverter" />
            <converters:AmountFormatConverter x:Key="AmountFormatConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <VerticalStackLayout Padding="20" Spacing="4">
        <Label Text="Monthly Cash Flow Projection" FontAttributes="Bold" FontSize="20"/>
        <CollectionView ItemsSource="{Binding Projections}"
                        SelectionMode="Single"
                        SelectedItem="{Binding SelectedProjection, Mode=TwoWay}">
            <CollectionView.Header>
                <Grid ColumnDefinitions="150,150,150,150,150" Padding="0,0,20,5">
                    <Label Text="Month" FontAttributes="Bold" Grid.Column="0"/>
                    <Label Text="Opening Balance" FontAttributes="Bold" Grid.Column="1" HorizontalOptions="End"/>
                    <Label Text="Income" FontAttributes="Bold" Grid.Column="2" HorizontalOptions="End"/>
                    <Label Text="Expenses" FontAttributes="Bold" Grid.Column="3" HorizontalOptions="End"/>
                    <Label Text="Ending Balance" FontAttributes="Bold" Grid.Column="4" HorizontalOptions="End"/>
                </Grid>
            </CollectionView.Header>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid ColumnDefinitions="150,150,150,150,150" Padding="0,0,20,5">
                        <Label Text="{Binding Month}" Grid.Column="0"/>
                        <Label Text="{Binding OpeningBalance, Converter={StaticResource AmountFormatConverter}}"
                               TextColor="{Binding OpeningBalance, Converter={StaticResource AmountColorConverter}}"
                               Grid.Column="1" HorizontalOptions="End"/>
                        <Label Text="{Binding Income, Converter={StaticResource AmountFormatConverter}}"
                               TextColor="{Binding Income, Converter={StaticResource AmountColorConverter}}"
                               Grid.Column="2" HorizontalOptions="End"/>
                        <Label Text="{Binding Expenses, Converter={StaticResource AmountFormatConverter}}"
                               TextColor="{Binding Expenses, Converter={StaticResource AmountColorConverter}}"
                               Grid.Column="3" HorizontalOptions="End"/>
                        <Label Text="{Binding EndingBalance, Converter={StaticResource AmountFormatConverter}}"
                               TextColor="{Binding EndingBalance, Converter={StaticResource AmountColorConverter}}"
                               Grid.Column="4" HorizontalOptions="End"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Income Table -->
        <Label Text="Income Details" FontAttributes="Bold" FontSize="16" Margin="0,10,0,0"/>
        <CollectionView ItemsSource="{Binding SelectedMonthIncome}" >
            <CollectionView.Header>
                <Grid ColumnDefinitions="2*,1*" Padding="0,0,20,5">
                    <Label Text="Category" FontAttributes="Bold" Grid.Column="0"/>
                    <Label Text="Amount" FontAttributes="Bold" Grid.Column="1" HorizontalOptions="End"/>
                </Grid>
            </CollectionView.Header>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid ColumnDefinitions="2*,1*" Padding="0,0,20,5">
                        <Label Text="{Binding Category}" Grid.Column="0"/>
                        <Label Text="{Binding Amount, Converter={StaticResource AmountFormatConverter}}"
                               TextColor="{Binding Amount, Converter={StaticResource AmountColorConverter}}"
                               Grid.Column="1" HorizontalOptions="End"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Expense Table -->
        <Label Text="Expense Details" FontAttributes="Bold" FontSize="16" Margin="0,5,0,0"/>
        <CollectionView ItemsSource="{Binding SelectedMonthExpenses}" >
            <CollectionView.Header>
                <Grid ColumnDefinitions="2*,1*" Padding="0,0,20,5">
                    <Label Text="Category" FontAttributes="Bold" Grid.Column="0"/>
                    <Label Text="Amount" FontAttributes="Bold" Grid.Column="1" HorizontalOptions="End"/>
                </Grid>
            </CollectionView.Header>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid ColumnDefinitions="2*,1*" Padding="0,0,20,5">
                        <Label Text="{Binding Category}" Grid.Column="0"/>
                        <Label Text="{Binding Amount, Converter={StaticResource AmountFormatConverter}}"
                               TextColor="{Binding Amount, Converter={StaticResource AmountColorConverter}}"
                               Grid.Column="1" HorizontalOptions="End"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button Text="Return"
                x:Name="ReturnButton"
                WidthRequest="96"
                BackgroundColor="IndianRed"
                TextColor="Black"
                FontSize="16"
                HorizontalOptions="Fill"
                Clicked="ReturnButton_Clicked" />
    </VerticalStackLayout>
</ContentPage>