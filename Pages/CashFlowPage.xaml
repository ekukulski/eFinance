<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="KukiFinance.Pages.CashFlowPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:KukiFinance.ViewModels"
    Title="Cash Flow">

    <ContentPage.BindingContext>
        <viewmodels:CashFlowViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto,*" Padding="10">

        <!-- ================= ERROR MESSAGE ================= -->
        <Frame
            Grid.Row="0"
            IsVisible="{Binding HasError}"
            BackgroundColor="#FFEEEE"
            BorderColor="Red"
            Padding="10"
            Margin="0,0,0,10">

            <Label
                Text="{Binding LoadError}"
                TextColor="Red"
                FontAttributes="Bold"
                LineBreakMode="WordWrap" />
        </Frame>

        <!-- ================= MAIN CONTENT ================= -->
        <Grid Grid.Row="1" ColumnDefinitions="2*,*">

            <!-- ===== LEFT: MONTHLY PROJECTIONS ===== -->
            <CollectionView
                Grid.Column="0"
                ItemsSource="{Binding Projections}"
                SelectionMode="Single"
                SelectedItem="{Binding SelectedProjection}">

                <CollectionView.Header>
                    <Label
                        Text="Monthly Cash Flow"
                        FontAttributes="Bold"
                        FontSize="18"
                        Margin="0,0,0,8" />
                </CollectionView.Header>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid
                            Padding="6"
                            ColumnDefinitions="*,Auto,Auto,Auto">

                            <Label Text="{Binding Month}" />

                            <Label
                                Grid.Column="1"
                                Text="{Binding OpeningBalance, StringFormat='Open: {0:C}'}"
                                Margin="10,0,0,0" />

                            <Label
                                Grid.Column="2"
                                Text="{Binding Income, StringFormat='Income: {0:C}'}"
                                TextColor="Green"
                                Margin="10,0,0,0" />

                            <Label
                                Grid.Column="3"
                                Text="{Binding Expenses, StringFormat='Expenses: {0:C}'}"
                                TextColor="Red"
                                Margin="10,0,0,0" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- ===== RIGHT: DETAILS ===== -->
            <ScrollView Grid.Column="1" Padding="10,0,0,0">

                <VerticalStackLayout Spacing="15">

                    <!-- Selected Month -->
                    <Label
                        Text="{Binding SelectedProjection.Month, StringFormat='Details for {0}'}"
                        FontSize="18"
                        FontAttributes="Bold" />

                    <!-- Income -->
                    <Label Text="Income" FontAttributes="Bold" />

                    <CollectionView ItemsSource="{Binding SelectedMonthIncome}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <HorizontalStackLayout Padding="4">
                                    <Label Text="{Binding Category}" />
                                    <Label
                                        Text="{Binding Amount, StringFormat='{0:C}'}"
                                        HorizontalOptions="EndAndExpand"
                                        TextColor="Green" />
                                </HorizontalStackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Expenses -->
                    <Label Text="Expenses" FontAttributes="Bold" />

                    <CollectionView ItemsSource="{Binding SelectedMonthExpenses}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <HorizontalStackLayout Padding="4">
                                    <Label Text="{Binding Category}" />
                                    <Label
                                        Text="{Binding Amount, StringFormat='{0:C}'}"
                                        HorizontalOptions="EndAndExpand"
                                        TextColor="Red" />
                                </HorizontalStackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                </VerticalStackLayout>
            </ScrollView>

        </Grid>
    </Grid>
</ContentPage>
